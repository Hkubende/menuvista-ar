<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MenuVista • Menu</title>
  <style>
    :root { color-scheme: dark; }
    body{margin:0;font-family:system-ui;background:#0b0b10;color:#fff}
    .wrap{max-width:1100px;margin:0 auto;padding:18px}
    .top{display:flex;justify-content:space-between;align-items:flex-start;gap:12px}
    .brand{font-weight:900;font-size:18px}
    .sub{opacity:.8;font-size:13px;margin-top:4px}
    .search{margin:14px 0}
    input{
      width:100%;padding:12px 14px;border-radius:14px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.06);color:#fff;outline:none;font-weight:700;
    }
    .grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}
    @media (min-width:860px){.grid{grid-template-columns:repeat(3,minmax(0,1fr));}}
    .card{
      border:1px solid rgba(255,255,255,.12);
      background:rgba(0,0,0,.35);
      border-radius:18px;overflow:hidden;
      transition:transform .12s ease;
    }
    .card:hover{transform:translateY(-2px)}
    .thumb{height:160px;background:rgba(255,255,255,.04);background-size:cover;background-position:center}
    .body{padding:12px}
    .name{font-weight:900;margin:0 0 4px}
    .desc{margin:0;opacity:.85;font-size:12.5px;line-height:1.35}
    .row{display:flex;align-items:center;justify-content:space-between;margin-top:10px;gap:10px}
    .price{font-weight:900;color:#FF7A2F}
    .btn{
      padding:8px 10px;border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.08);
      font-weight:900;font-size:12px;cursor:pointer;user-select:none;
    }
    .cartBtn{
      display:flex;gap:8px;align-items:center;cursor:pointer;
      padding:8px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.08);font-weight:900;font-size:12px;
      user-select:none;
    }
    .badge{
      min-width:22px;height:22px;border-radius:999px;
      display:inline-flex;align-items:center;justify-content:center;
      background:#FF7A2F;color:#111;font-weight:900;font-size:12px;padding:0 6px;
    }

    /* drawer */
    .overlay{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;z-index:50}
    .overlay.show{display:block}
    .drawer{
      position:fixed;top:0;right:0;height:100%;width:min(420px,92vw);
      background:rgba(10,10,16,.92);
      border-left:1px solid rgba(255,255,255,.12);
      backdrop-filter: blur(12px);
      transform:translateX(100%);
      transition:transform .18s ease;
      z-index:60;display:flex;flex-direction:column;
    }
    .drawer.show{transform:translateX(0)}
    .drawerHeader{padding:14px;display:flex;justify-content:space-between;align-items:center}
    .drawerTitle{font-weight:900}
    .close{cursor:pointer;opacity:.85}
    .cartList{padding:0 14px 14px;overflow:auto;flex:1}
    .item{
      border:1px solid rgba(255,255,255,.12);
      border-radius:16px;padding:10px;background:rgba(0,0,0,.25);
      display:flex;justify-content:space-between;gap:10px;margin-bottom:10px;
    }
    .itemName{font-weight:900;margin:0 0 4px}
    .itemMeta{opacity:.85;font-size:12px;margin:0}
    .qtyRow{display:flex;gap:8px;align-items:center;justify-content:flex-end}
    .qtyBtn{
      width:34px;height:34px;border-radius:12px;border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.08);color:#fff;font-weight:900;cursor:pointer;
    }
    .qty{min-width:26px;text-align:center;font-weight:900}
    .drawerFooter{border-top:1px solid rgba(255,255,255,.12);padding:12px 14px;background:rgba(0,0,0,.25)}
    .totalRow{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
    .totalAmt{font-weight:900;color:#FF7A2F}
    .ctaRow{display:flex;gap:10px;flex-wrap:wrap}
    .primary{background:#FF7A2F;color:#111;border:0;border-radius:14px;padding:10px 12px;font-weight:900;cursor:pointer;flex:1}
    .ghost{background:rgba(255,255,255,.10);color:#fff;border:1px solid rgba(255,255,255,.14);border-radius:14px;padding:10px 12px;font-weight:900;cursor:pointer;}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div>
        <div class="brand">MenuVista • Demo Restaurant</div>
        <div class="sub">Tap “AR Preview” to view the 3D dish and place it on a table.</div>
      </div>
      <div class="cartBtn" id="openCartBtn">
        Cart <span class="badge" id="cartCount">0</span>
      </div>
    </div>

    <div class="search">
      <input id="q" placeholder="Search (burger, fries, chicken)..." />
    </div>

    <div class="grid" id="grid"></div>
  </div>

  <!-- Cart Drawer -->
  <div class="overlay" id="overlay"></div>
  <div class="drawer" id="drawer">
    <div class="drawerHeader">
      <div class="drawerTitle">Your Cart</div>
      <div class="close" id="closeCartBtn">✕</div>
    </div>
    <div class="cartList" id="cartList"></div>
    <div class="drawerFooter">
      <div class="totalRow">
        <div style="opacity:.85">Total</div>
        <div class="totalAmt" id="cartTotal">KSh 0</div>
      </div>
      <div class="ctaRow">
        <button class="ghost" id="clearCartBtn">Clear</button>
        <button class="primary" id="checkoutBtn">Checkout</button>
      </div>
    </div>
  </div>

<script>
  const CART_KEY = "mv_cart_v1";

  // ✅ Make sure these files exist EXACTLY with same case:
  // models/burger.glb, models/fries.glb, models/chicken.glb
  // Images/burger.png, Images/fries.png, Images/chicken.png
  const dishes = [
    { id:"burger",  name:"Burger",  price:850, desc:"Burger (3D preview)",  model:"models/burger.glb",  thumb:"Images/burger.png" },
    { id:"fries",   name:"Fries",   price:350, desc:"Fries (3D preview)",   model:"models/fries.glb",   thumb:"Images/fries.png" },
    { id:"chicken", name:"Chicken", price:900, desc:"Chicken (3D preview)", model:"models/chicken.glb", thumb:"Images/chicken.png" }
  ];

  const grid = document.getElementById("grid");
  const q = document.getElementById("q");

  function openDish(id){
    // opens your AR viewer page
    location.href = `ar.html?dish=${encodeURIComponent(id)}`;
  }

  // ---------- CART ----------
  function loadCart(){
    try { return JSON.parse(localStorage.getItem(CART_KEY) || "{}"); }
    catch { return {}; }
  }
  function saveCart(cart){
    localStorage.setItem(CART_KEY, JSON.stringify(cart));
    updateCartUI();
  }
  function addToCart(id){
    const cart = loadCart();
    cart[id] = (cart[id] || 0) + 1;
    saveCart(cart);
    openCart();
  }
  function setQty(id, qty){
    const cart = loadCart();
    if(qty <= 0) delete cart[id];
    else cart[id] = qty;
    saveCart(cart);
  }
  function clearCart(){
    localStorage.removeItem(CART_KEY);
    updateCartUI();
  }
  function cartCount(cart){ return Object.values(cart).reduce((a,b)=>a+b,0); }
  function cartTotal(cart){
    let total=0;
    for(const [id, qty] of Object.entries(cart)){
      const d = dishes.find(x=>x.id===id);
      if(d) total += d.price * qty;
    }
    return total;
  }
  const formatKsh = (n)=> "KSh " + Number(n).toLocaleString("en-KE");

  // ---------- RENDER ----------
  function render(){
    const term = q.value.trim().toLowerCase();
    grid.innerHTML = "";
    dishes
      .filter(d => !term || d.name.toLowerCase().includes(term) || d.desc.toLowerCase().includes(term))
      .forEach(d => {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
          <div class="thumb" style="background-image:url('${d.thumb}')"></div>
          <div class="body">
            <p class="name">${d.name}</p>
            <p class="desc">${d.desc}</p>
            <div class="row">
              <div class="price">${formatKsh(d.price)}</div>
              <div style="display:flex;gap:8px">
                <div class="btn" data-ar>AR Preview</div>
                <div class="btn" data-add>Add</div>
              </div>
            </div>
          </div>
        `;
        card.querySelector("[data-ar]").onclick = () => openDish(d.id);
        card.querySelector("[data-add]").onclick = () => addToCart(d.id);
        grid.appendChild(card);
      });
  }
  q.addEventListener("input", render);

  // ---------- DRAWER UI ----------
  const overlay = document.getElementById("overlay");
  const drawer  = document.getElementById("drawer");
  const openCartBtn = document.getElementById("openCartBtn");
  const closeCartBtn = document.getElementById("closeCartBtn");
  const cartList = document.getElementById("cartList");
  const cartCountEl = document.getElementById("cartCount");
  const cartTotalEl = document.getElementById("cartTotal");
  const clearCartBtn = document.getElementById("clearCartBtn");
  const checkoutBtn = document.getElementById("checkoutBtn");

  function openCart(){
    overlay.classList.add("show");
    drawer.classList.add("show");
    updateCartUI();
  }
  function closeCart(){
    overlay.classList.remove("show");
    drawer.classList.remove("show");
  }
  overlay.onclick = closeCart;
  openCartBtn.onclick = openCart;
  closeCartBtn.onclick = closeCart;
  clearCartBtn.onclick = clearCart;

  checkoutBtn.onclick = () => {
    const cart = loadCart();
    if(cartCount(cart) === 0){
      alert("Cart is empty.");
      return;
    }
    // send cart to ar.html checkout mode
    const payload = encodeURIComponent(btoa(JSON.stringify(cart)));
    location.href = `ar.html?checkout=1&cart=${payload}`;
  };

  function updateCartUI(){
    const cart = loadCart();
    cartCountEl.textContent = cartCount(cart);
    cartTotalEl.textContent = formatKsh(cartTotal(cart));

    cartList.innerHTML = "";
    const entries = Object.entries(cart);

    if(entries.length === 0){
      cartList.innerHTML = `<div style="opacity:.8;padding:10px 2px">Your cart is empty.</div>`;
      return;
    }

    for(const [id, qty] of entries){
      const d = dishes.find(x=>x.id===id);
      if(!d) continue;

      const item = document.createElement("div");
      item.className = "item";
      item.innerHTML = `
        <div>
          <p class="itemName">${d.name}</p>
          <p class="itemMeta">${formatKsh(d.price)} each</p>
        </div>
        <div style="text-align:right">
          <div class="itemMeta" style="margin-bottom:8px">${formatKsh(d.price * qty)}</div>
          <div class="qtyRow">
            <button class="qtyBtn" data-dec>-</button>
            <div class="qty">${qty}</div>
            <button class="qtyBtn" data-inc>+</button>
          </div>
        </div>
      `;
      item.querySelector("[data-dec]").onclick = () => setQty(id, qty-1);
      item.querySelector("[data-inc]").onclick = () => setQty(id, qty+1);
      cartList.appendChild(item);
    }
  }

  // quick asset sanity check (optional, helps you find wrong paths)
  // This will show a console warning if a thumb doesn't load.
  dishes.forEach(d=>{
    const img = new Image();
    img.onload = ()=>{};
    img.onerror = ()=>console.warn("Missing thumbnail:", d.thumb);
    img.src = d.thumb;
  });

  render();
  updateCartUI();
</script>
</body>
</html>
